version: "3.9"
services:

  # PEEERID: 12D3KooWP1F2VnTpS9guj9ETnyeUe1eMsreF5XNAhZTkTqVw2m5V
  light-gateway:
    depends_on: [storage-only]
    image: tipfs:test
    command: [ "run" ]
    environment:
      - P2P_SECRETKEY=CAESQP09xah2sbO0+HnFOcO0we5mRw8mOTE7kTyuFTxuZLwWw/E+RLOQdRnif88FpqxXl6CiYp3Uw0h8ljLtaz5TeDw=
    volumes:
      - $PWD/light-gateway.yml:/etc/tezos-ipfs/config.yml
    ports:
      - "18085:8085"

  # PEEERID: USES IPFS NODE - 12D3KooWSb2MqWGib529J5vR2nW9FpuNh6L2y71M9zNLwiFPa4ez
  storage-only:
    depends_on:
      ipfs-one:
        condition: service_healthy
    image: tipfs:test
    command: [ "run" ]
    volumes:
      - $PWD/storage-only.yml:/etc/tezos-ipfs/config.yml

  # PEEERID: 12D3KooWSb2MqWGib529J5vR2nW9FpuNh6L2y71M9zNLwiFPa4ez
  ipfs-one:
    image: ipfs/go-ipfs:latest
    command: ["daemon","--routing","dht","--enable-pubsub-experiment"]
    healthcheck:
      test: [ "CMD", "wget", "http://localhost:5001/webui" ]
      interval: 30s
      timeout: 10s
      retries: 15
    volumes:
      - $PWD/ipfs-one/:/data/ipfs

  # PEEERID: 12D3KooWK4Typh8no29AF2iCJ5QEDRZAbFrWLavE5v3G1NWQbKwM
  copycat:
    depends_on: [storage-only]
    image: tipfs:test
    command: [ "run" ]
    environment:
      - P2P_SECRETKEY=CAESQCRA2E6dn4/3aai4BoNnr9joiBXTFycY1CXERO7YpEMxiVXijbvkqKiLBjPpu+/duRm5zhphpULZY6V4+cXYm/g=
    volumes:
      - $PWD/copycat.yml:/etc/tezos-ipfs/config.yml
    ports:
      - "28085:8085"